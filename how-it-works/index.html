
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Cloud-native workload optimization scheduler based on Linux Scheduler Extension" name="description"/>
<link href="https://gthulhu.org/how-it-works/" rel="canonical"/>
<link href="../k8s/" rel="prev"/>
<link href="../project-goals/" rel="next"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-9.5.17" name="generator"/>
<title>How It Works - Gthulhu</title>
<link href="../assets/stylesheets/main.bcfcd587.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-T0RWMB3KJM"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-T0RWMB3KJM",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-T0RWMB3KJM",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
<script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#how-it-works">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Gthulhu" class="md-header__button md-logo" data-md-component="logo" href=".." title="Gthulhu">
<img alt="logo" src="https://raw.githubusercontent.com/Gthulhu/Gthulhu/main/assets/logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Gthulhu
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              How It Works
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__option">
<div class="md-select">
<button aria-label="Select language" class="md-header__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"></path></svg>
</button>
<div class="md-select__inner">
<ul class="md-select__list">
<li class="md-select__item">
<a class="md-select__link" href="./" hreflang="en">
              English
            </a>
</li>
<li class="md-select__item">
<a class="md-select__link" href="../zh/how-it-works/" hreflang="zh">
              中文
            </a>
</li>
</ul>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/Gthulhu/Gthulhu" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../installation/">
          
  
  Get Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../contributing/">
        
  
    
  
  Contributing

      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Gthulhu" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Gthulhu">
<img alt="logo" src="https://raw.githubusercontent.com/Gthulhu/Gthulhu/main/assets/logo.png"/>
</a>
    Gthulhu
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/Gthulhu/Gthulhu" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-ellipsis">
    Get Started
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Get Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../installation/">
<span class="md-ellipsis">
    Installation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../k8s/">
<span class="md-ellipsis">
    K8s Deployment
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    How It Works
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    How It Works
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overall-architecture">
<span class="md-ellipsis">
      Overall Architecture
    </span>
</a>
<nav aria-label="Overall Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dual-component-design">
<span class="md-ellipsis">
      Dual-Component Design
    </span>
</a>
<nav aria-label="Dual-Component Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-bpf-scheduler">
<span class="md-ellipsis">
      1. BPF Scheduler
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-gthulhu-user-space-scheduler">
<span class="md-ellipsis">
      2. Gthulhu (User Space Scheduler)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cpu-topology-aware-scheduling">
<span class="md-ellipsis">
      CPU Topology-Aware Scheduling
    </span>
</a>
<nav aria-label="CPU Topology-Aware Scheduling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#hierarchical-cpu-selection">
<span class="md-ellipsis">
      Hierarchical CPU Selection
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-and-scheduling-policy-design">
<span class="md-ellipsis">
      API and Scheduling Policy Design
    </span>
</a>
<nav aria-label="API and Scheduling Policy Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-architecture">
<span class="md-ellipsis">
      API Architecture
    </span>
</a>
<nav aria-label="API Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-endpoints">
<span class="md-ellipsis">
      API Endpoints
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scheduling-strategy-data-model">
<span class="md-ellipsis">
      Scheduling Strategy Data Model
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-application-flow">
<span class="md-ellipsis">
      Strategy Application Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kubernetes-integration">
<span class="md-ellipsis">
      Kubernetes Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-prioritization-logic">
<span class="md-ellipsis">
      Strategy Prioritization Logic
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-parameters">
<span class="md-ellipsis">
      Configuration Parameters
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bpf-and-user-space-communication">
<span class="md-ellipsis">
      BPF and User Space Communication
    </span>
</a>
<nav aria-label="BPF and User Space Communication" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#communication-mechanism">
<span class="md-ellipsis">
      Communication Mechanism
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debugging-and-monitoring">
<span class="md-ellipsis">
      Debugging and Monitoring
    </span>
</a>
<nav aria-label="Debugging and Monitoring" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#bpf-tracing">
<span class="md-ellipsis">
      BPF Tracing
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#differences-from-cfs">
<span class="md-ellipsis">
      Differences from CFS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#future-development-directions">
<span class="md-ellipsis">
      Future Development Directions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../project-goals/">
<span class="md-ellipsis">
    Project Goals
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../development-history/">
<span class="md-ellipsis">
    Development History
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../api-reference/">
<span class="md-ellipsis">
    API Reference
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../faq/">
<span class="md-ellipsis">
    FAQ
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mentioned/">
<span class="md-ellipsis">
    Mentioned
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../contributing/">
<span class="md-ellipsis">
    Contributing
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overall-architecture">
<span class="md-ellipsis">
      Overall Architecture
    </span>
</a>
<nav aria-label="Overall Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dual-component-design">
<span class="md-ellipsis">
      Dual-Component Design
    </span>
</a>
<nav aria-label="Dual-Component Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-bpf-scheduler">
<span class="md-ellipsis">
      1. BPF Scheduler
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-gthulhu-user-space-scheduler">
<span class="md-ellipsis">
      2. Gthulhu (User Space Scheduler)
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cpu-topology-aware-scheduling">
<span class="md-ellipsis">
      CPU Topology-Aware Scheduling
    </span>
</a>
<nav aria-label="CPU Topology-Aware Scheduling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#hierarchical-cpu-selection">
<span class="md-ellipsis">
      Hierarchical CPU Selection
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-and-scheduling-policy-design">
<span class="md-ellipsis">
      API and Scheduling Policy Design
    </span>
</a>
<nav aria-label="API and Scheduling Policy Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-architecture">
<span class="md-ellipsis">
      API Architecture
    </span>
</a>
<nav aria-label="API Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-endpoints">
<span class="md-ellipsis">
      API Endpoints
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scheduling-strategy-data-model">
<span class="md-ellipsis">
      Scheduling Strategy Data Model
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-application-flow">
<span class="md-ellipsis">
      Strategy Application Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kubernetes-integration">
<span class="md-ellipsis">
      Kubernetes Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#strategy-prioritization-logic">
<span class="md-ellipsis">
      Strategy Prioritization Logic
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-parameters">
<span class="md-ellipsis">
      Configuration Parameters
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bpf-and-user-space-communication">
<span class="md-ellipsis">
      BPF and User Space Communication
    </span>
</a>
<nav aria-label="BPF and User Space Communication" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#communication-mechanism">
<span class="md-ellipsis">
      Communication Mechanism
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debugging-and-monitoring">
<span class="md-ellipsis">
      Debugging and Monitoring
    </span>
</a>
<nav aria-label="Debugging and Monitoring" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#bpf-tracing">
<span class="md-ellipsis">
      BPF Tracing
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#differences-from-cfs">
<span class="md-ellipsis">
      Differences from CFS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#future-development-directions">
<span class="md-ellipsis">
      Future Development Directions
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="how-it-works">How It Works</h1>
<p>This page provides detailed information about the core working principles and technical architecture of Gthulhu and Qumun schedulers.</p>
<h2 id="overall-architecture">Overall Architecture</h2>
<h3 id="dual-component-design">Dual-Component Design</h3>
<p>Gthulhu scheduler adopts a modern dual-component architecture:</p>
<p><img alt="" src="../assets/qumun.png"/></p>
<h4 id="1-bpf-scheduler">1. BPF Scheduler</h4>
<p>A BPF scheduler implemented based on the Linux kernel's sched_ext framework, responsible for low-level scheduling functions such as task queue management, CPU selection logic, and scheduling execution.
The BPF scheduler communicates with the user-space Gthulhu scheduler through two types of eBPF Maps: ring buffer and user ring buffer.</p>
<h4 id="2-gthulhu-user-space-scheduler">2. Gthulhu (User Space Scheduler)</h4>
<p>The Gthulhu scheduler, developed using the qumun framework, receives information about tasks to be scheduled from the ring buffer eBPF Map and makes decisions based on scheduling policies.
Finally, the scheduling results are sent back to the BPF Scheduler through the user ring buffer eBPF Map.</p>
<p><img alt="" src="../assets/plugin.png"/></p>
<p>The Gthulhu scheduler supports a plugin-based design, allowing developers to extend and customize scheduling policies according to their needs.
<a href="https://github.com/Gthulhu/plugin/tree/main/plugin">Gthulhu/plugin</a> currently implements two schedulers:</p>
<ul>
<li>Simple Scheduler: A simple scheduler implemented with reference to scx_simple, with core logic of approximately 200 lines.</li>
<li>Gthulhu Scheduler: A virtual runtime-based scheduler with latency-sensitive optimization and CPU topology-aware features.</li>
</ul>
<h2 id="cpu-topology-aware-scheduling">CPU Topology-Aware Scheduling</h2>
<h3 id="hierarchical-cpu-selection">Hierarchical CPU Selection</h3>
<pre class="mermaid"><code>graph TB
    A[Task Needs CPU] --&gt; AA{Single CPU Allowed?}
    AA --&gt;|Yes| AB[Check if CPU is Idle]
    AA --&gt;|No| B{SMT System?}

    AB --&gt;|Idle| AC[Use Previous CPU]
    AB --&gt;|Not Idle| AD[Fail with EBUSY]

    B --&gt;|Yes| C{Previous CPU Full-Idle Core?}
    B --&gt;|No| G{Previous CPU Idle?}

    C --&gt;|Yes| D[Use Previous CPU]
    C --&gt;|No| E{Full-Idle CPU in L2 Cache?}

    E --&gt;|Yes| F[Use CPU in Same L2 Cache]
    E --&gt;|No| H{Full-Idle CPU in L3 Cache?}

    H --&gt;|Yes| I[Use CPU in Same L3 Cache]
    H --&gt;|No| J{Any Full-Idle Core Available?}

    J --&gt;|Yes| K[Use Any Full-Idle Core]
    J --&gt;|No| G

    G --&gt;|Yes| L[Use Previous CPU]
    G --&gt;|No| M{Any Idle CPU in L2 Cache?}

    M --&gt;|Yes| N[Use CPU in Same L2 Cache]
    M --&gt;|No| O{Any Idle CPU in L3 Cache?}

    O --&gt;|Yes| P[Use CPU in Same L3 Cache]
    O --&gt;|No| Q{Any Idle CPU Available?}

    Q --&gt;|Yes| R[Use Any Idle CPU]
    Q --&gt;|No| S[Return EBUSY]
</code></pre>
<h2 id="api-and-scheduling-policy-design">API and Scheduling Policy Design</h2>
<p>Gthulhu implements a flexible mechanism to dynamically adjust its scheduling behavior through a RESTful API interface. This allows operators to fine-tune the scheduler's performance characteristics without restarting or recompiling the code.</p>
<h3 id="api-architecture">API Architecture</h3>
<p>The API server provides endpoints for retrieving and setting scheduling strategies:</p>
<pre class="mermaid"><code>graph TB
    A[Gthulhu Scheduler] --&gt;|Periodic Requests| B[API Server]
    C[Operators/Admins] --&gt;|Configure Strategies| B
    B --&gt;|Return Strategies| A
    A --&gt;|Apply Strategies| D[Task Scheduling]

    subgraph "External Management"
        C
    end

    subgraph "Scheduling System"
        A
        D
    end
</code></pre>
<h4 id="api-endpoints">API Endpoints</h4>
<p>The API server exposes two primary endpoints for scheduling strategy management:</p>
<ul>
<li><strong>GET /api/v1/scheduling/strategies</strong>: Retrieves current scheduling strategies</li>
<li><strong>POST /api/v1/scheduling/strategies</strong>: Sets new scheduling strategies</li>
</ul>
<h3 id="scheduling-strategy-data-model">Scheduling Strategy Data Model</h3>
<p>A scheduling strategy is represented using the following structure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">{</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="nt">"scheduling"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="p">{</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">      </span><span class="nt">"priority"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">      </span><span class="nt">"execution_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">20000000</span><span class="p">,</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">      </span><span class="nt">"pid"</span><span class="p">:</span><span class="w"> </span><span class="mi">12345</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="p">},</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="p">{</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">      </span><span class="nt">"priority"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">      </span><span class="nt">"execution_time"</span><span class="p">:</span><span class="w"> </span><span class="mi">10000000</span><span class="p">,</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">      </span><span class="nt">"selectors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">        </span><span class="p">{</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">          </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tier"</span><span class="p">,</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">          </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"control-plane"</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">      </span><span class="p">]</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="p">}</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">  </span><span class="p">]</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="p">}</span>
</code></pre></div>
<p>Key components of a scheduling strategy:</p>
<ol>
<li><strong>Priority</strong> (<code>boolean</code>): When true, the task's virtual runtime is set to the minimum value, effectively giving it the highest scheduling priority</li>
<li><strong>Execution Time</strong> (<code>uint64</code>): Custom time slice in nanoseconds for the task</li>
<li><strong>PID</strong> (<code>int</code>): Process ID to which the strategy applies</li>
<li><strong>Selectors</strong> (<code>array</code>): Optional Kubernetes label selectors for targeting groups of processes</li>
</ol>
<h3 id="strategy-application-flow">Strategy Application Flow</h3>
<p>The process of fetching and applying scheduling strategies follows this sequence:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant S as Scheduler
    participant A as API Server
    participant T as Task Pool

    S-&gt;&gt;S: Initialize scheduler
    S-&gt;&gt;S: Start strategy fetcher

    loop Every interval seconds
        S-&gt;&gt;A: Request current strategies
        A-&gt;&gt;S: Return strategy list
        S-&gt;&gt;S: Update strategy map
    end

    Note over S,T: During task scheduling
    T-&gt;&gt;S: Task needs scheduling
    S-&gt;&gt;S: Check if task has custom strategy
    S-&gt;&gt;S: Apply priority setting if needed
    S-&gt;&gt;S: Apply custom execution time if specified
    S-&gt;&gt;T: Schedule task with applied strategy
</code></pre>
<h3 id="kubernetes-integration">Kubernetes Integration</h3>
<p>For containerized environments, Gthulhu can map scheduling strategies to specific pods using label selectors:</p>
<ol>
<li><strong>Label Selector Resolution</strong>: The API server translates label selectors into specific PIDs by scanning the system for matching pods</li>
<li><strong>PID Mapping</strong>: Each pod's processes are identified and associated with the appropriate scheduling strategy</li>
<li><strong>Dynamic Updates</strong>: As pods are created, destroyed, or moved, the scheduler adapts by periodically refreshing its strategies</li>
</ol>
<h3 id="strategy-prioritization-logic">Strategy Prioritization Logic</h3>
<p>When applying scheduling strategies, Gthulhu follows these rules:</p>
<ol>
<li><strong>Direct PID Match</strong>: Strategies that explicitly specify a PID have highest precedence</li>
<li><strong>Label Selector Match</strong>: Strategies using label selectors apply to all matching processes</li>
<li><strong>Default Behavior</strong>: Processes without specific strategies use the standard scheduling algorithm</li>
</ol>
<h3 id="configuration-parameters">Configuration Parameters</h3>
<p>The strategy fetching behavior can be configured through the scheduler's configuration file:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="nt">api</span><span class="p">:</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">  </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">"http://api-server:8080"</span><span class="w">   </span><span class="c1"># API server endpoint</span>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w">                    </span><span class="c1"># Refresh interval in seconds</span>
</code></pre></div>
<p>This architecture allows for dynamic, fine-grained control over scheduling behavior without interrupting the scheduler's operation.</p>
<h2 id="bpf-and-user-space-communication">BPF and User Space Communication</h2>
<h3 id="communication-mechanism">Communication Mechanism</h3>
<pre class="mermaid"><code>sequenceDiagram
    participant K as BPF (Kernel Space)
    participant U as Go (User Space)

    K-&gt;&gt;U: Task Creation Event
    U-&gt;&gt;U: Analyze Task Characteristics
    U-&gt;&gt;K: Set Scheduling Parameters
    K-&gt;&gt;K: Apply Scheduling Decision
    K-&gt;&gt;U: Statistics Update
    U-&gt;&gt;U: Dynamic Strategy Adjustment
</code></pre>
<h2 id="debugging-and-monitoring">Debugging and Monitoring</h2>
<h3 id="bpf-tracing">BPF Tracing</h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># Monitor BPF program execution</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>sudo<span class="w"> </span>cat<span class="w"> </span>/sys/kernel/debug/tracing/trace_pipe
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="c1"># Check BPF statistics</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>sudo<span class="w"> </span>bpftool<span class="w"> </span>prog<span class="w"> </span>show
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>sudo<span class="w"> </span>bpftool<span class="w"> </span>map<span class="w"> </span>dump<span class="w"> </span>name<span class="w"> </span>task_info_map
</code></pre></div>
<h2 id="differences-from-cfs">Differences from CFS</h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>CFS (Completely Fair Scheduler)</th>
<th>Gthulhu</th>
</tr>
</thead>
<tbody>
<tr>
<td>Scheduling Policy</td>
<td>Virtual runtime based</td>
<td>Virtual runtime + latency optimization</td>
</tr>
<tr>
<td>Task Classification</td>
<td>Unified processing</td>
<td>Automatic classification optimization</td>
</tr>
<tr>
<td>CPU Selection</td>
<td>Basic load balancing</td>
<td>Topology-aware + cache affinity</td>
</tr>
<tr>
<td>Dynamic Adjustment</td>
<td>Limited</td>
<td>Comprehensive adaptive adjustment</td>
</tr>
<tr>
<td>Extensibility</td>
<td>Kernel built-in</td>
<td>User-space extensible</td>
</tr>
</tbody>
</table>
<h2 id="future-development-directions">Future Development Directions</h2>
<ol>
<li><strong>Machine Learning Integration</strong>: Use ML models to predict task behavior</li>
<li><strong>Container-Aware Scheduling</strong>: Optimization for containerized environments</li>
<li><strong>Energy Optimization</strong>: Integration of power management considerations</li>
<li><strong>Real-Time Task Support</strong>: Support for hard real-time task scheduling</li>
</ol>
<hr/>
<div class="admonition info">
<p class="admonition-title">Deep Dive</p>
<p>For more implementation details, refer to the <a href="../api-reference/">API Reference</a> and source code comments.</p>
</div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script></body>
</html>