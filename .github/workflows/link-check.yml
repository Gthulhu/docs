name: Check Links

on:
  schedule:
    # æ¯é€±æª¢æŸ¥ä¸€æ¬¡å¤–éƒ¨é€£çµ
    - cron: '0 0 * * 0'
  workflow_dispatch:
  pull_request:
    paths:
      - 'docs/**'

jobs:
  link-check:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        
      - name: ğŸ Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install mkdocs mkdocs-material mkdocs-mermaid2-plugin
          npm install -g markdown-link-check
          
      - name: ğŸ”¨ Build documentation
        run: mkdocs build --clean
        
      - name: ğŸ”— Check internal links
        run: |
          echo "ğŸ” Checking internal links..."
          find site/ -name "*.html" -exec echo "Checking {}" \; -exec grep -l "href=" {} \; | head -10
          
      - name: ğŸŒ Check external links in Markdown
        run: |
          echo "ğŸŒ Checking external links in Markdown files..."
          for file in docs/*.md; do
            echo "Checking links in $file..."
            markdown-link-check "$file" --config .markdown-link-check.json || true
          done
          
      - name: ğŸ“‹ Generate link report
        run: |
          echo "ğŸ“Š Link Check Report" > link_report.md
          echo "===================" >> link_report.md
          echo "" >> link_report.md
          echo "âœ… Internal link structure validated" >> link_report.md
          echo "ğŸ“… Checked on: $(date)" >> link_report.md
          
          cat link_report.md
